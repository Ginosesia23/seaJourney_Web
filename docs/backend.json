
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile on the SeaJourney Landing website.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "User's username."
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "profilePicture": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "bio": {
          "type": "string",
          "description": "A short biography or description of the user."
        },
        "registrationDate": {
          "type": "string",
          "description": "Date and time when the user registered.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "username",
        "registrationDate"
      ]
    },
    "Testimonial": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Testimonial",
      "type": "object",
      "description": "Represents a user testimonial about the AI tour creator feature.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Testimonial entity."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Testimonial)"
        },
        "content": {
          "type": "string",
          "description": "The text content of the testimonial."
        },
        "rating": {
          "type": "number",
          "description": "The rating given in the testimonial (e.g., 1-5 stars)."
        },
        "dateCreated": {
          "type": "string",
          "description": "Date and time when the testimonial was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userProfileId",
        "content",
        "rating",
        "dateCreated"
      ]
    },
    "Vessel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vessel",
      "type": "object",
      "description": "Represents a vessel that a user has worked on.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Vessel entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the vessel."
        },
        "type": {
          "type": "string",
          "description": "The type of vessel (e.g., Motor Yacht, Sailing Yacht)."
        },
        "officialNumber": {
          "type": "string",
          "description": "The official registration number of the vessel."
        },
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who owns this vessel entry."
        }
      },
      "required": [
        "id",
        "name",
        "type",
        "ownerId"
      ]
    },
    "CurrentStatus": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CurrentStatus",
      "type": "object",
      "description": "Represents the user's current active trip.",
      "properties": {
        "vesselId": {
          "type": "string",
          "description": "The ID of the vessel for the current trip."
        },
        "position": {
          "type": "string",
          "description": "The user's position or role on the vessel."
        },
        "startDate": {
          "type": "string",
          "format": "date-time",
          "description": "The start date of the current trip."
        },
        "dailyStates": {
          "type": "object",
          "description": "A map of dates to vessel states (e.g., 'at-sea', 'in-port')."
        }
      },
      "required": [
        "vesselId",
        "position",
        "startDate",
        "dailyStates"
      ]
    },
    "Trip": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Trip",
      "type": "object",
      "description": "Represents a user's completed trip record.",
      "properties": {
        "vesselId": {
          "type": "string",
          "description": "The ID of the vessel for the trip."
        },
        "position": {
          "type": "string",
          "description": "The user's position or role on the vessel."
        },
        "startDate": {
          "type": "string",
          "format": "date-time",
          "description": "The start date of the trip."
        },
        "endDate": {
          "type": "string",
          "format": "date-time",
          "description": "The end date of the trip."
        },
        "dailyStates": {
          "type": "object",
          "description": "A map of dates to vessel states (e.g., 'at-sea', 'in-port') for the duration of the trip."
        }
      },
      "required": [
        "vesselId",
        "position",
        "startDate",
        "endDate",
        "dailyStates"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profile/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. The profile is stored as a single document in a subcollection of the user's collection, with the document ID matching the user's UID to enforce ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/vessels/{vesselId}",
        "definition": {
          "entityName": "Vessel",
          "schema": {
            "$ref": "#/backend/entities/Vessel"
          },
          "description": "Stores vessels associated with a user. Path-based ownership enforces that a vessel is owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "vesselId",
              "description": "The unique identifier of the vessel."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/profile/testimonials/{testimonialId}",
        "definition": {
          "entityName": "Testimonial",
          "schema": {
            "$ref": "#/backend/entities/Testimonial"
          },
          "description": "Stores testimonials associated with a user profile. Path-based ownership enforces that a testimonial is owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "testimonialId",
              "description": "The unique identifier of the testimonial."
            }
          ]
        }
      },
       {
        "path": "/users/{userId}/currentStatus/{statusId}",
        "definition": {
          "entityName": "CurrentStatus",
          "schema": {
            "$ref": "#/backend/entities/CurrentStatus"
          },
          "description": "Stores the user's current active trip status. Should only contain one document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "statusId",
              "description": "The unique identifier of the status document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/trips/{tripId}",
        "definition": {
          "entityName": "Trip",
          "schema": {
            "$ref": "#/backend/entities/Trip"
          },
          "description": "Stores a user's past trip records. Path-based ownership enforces that a trip is owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "tripId",
              "description": "The unique identifier of the trip."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore data structure is designed to support the SeaJourney Landing website's user profiles and testimonials. The primary focus is on enabling secure and scalable data access while adhering to Authorization Independence and simplifying security rules. User profiles are stored under `/users/{userId}/profile/{userId}` following the Path-Based ownership access modeling strategy, where the profile document ID is the same as the user ID. This ensures a user can only access their own profile document. Testimonials are stored as subcollections of user profiles under `/users/{userId}/profile/testimonials/{testimonialId}`. By nesting the testimonials as a subcollection under each user profile, we establish clear ownership and enhance data organization. Vessels are stored in a top-level collection for each user `/users/{userId}/vessels/{vesselId}` which also enforces user ownership via the path.\n\nAuthorization Independence is achieved without denormalization as the path inherently enforces ownership, thus eliminating the need to read the data to authorize access. For testimonials, ownership is implied by the parent user profile. In this design, listing testimonials will be restricted to the user's own profile or testimonials can be queried across all users if this is required.\n\nQAPs (Rules are not Filters): The design supports secure `list` operations. Because testimonials are nested under user profiles and access to a profile is inherently restricted to the profile's user, reading all testimonials using the collection group query can be secured. It is recommended not to combine different security requirements into the same collection."
  }
}
